/**
 * @fileoverview jsTGALoader - Javascript loader for TGA file
 * @author Vincent Thibault
 * @version 1.2.0
 * @blog http://blog.robrowser.com/javascript-tga-loader.html
 */
!function(a){"use strict";function b(){}function c(a){if(a.imageType===b.Type.NO_DATA)throw new Error("Targa::checkHeader() - No data");if(a.hasColorMap){if(a.colorMapLength>256||24!==a.colorMapSize||1!==a.colorMapType)throw new Error("Targa::checkHeader() - Invalid colormap for indexed type")}else if(a.colorMapType)throw new Error("Targa::checkHeader() - Why does the image contain a palette ?");if(a.width<=0||a.height<=0)throw new Error("Targa::checkHeader() - Invalid image size");if(8!==a.pixelDepth&&16!==a.pixelDepth&&24!==a.pixelDepth&&32!==a.pixelDepth)throw new Error('Targa::checkHeader() - Invalid pixel size "'+a.pixelDepth+'"')}function d(a,b,c,d){var e,f,g,h,i,j;for(j=new Uint8Array(d),i=new Uint8Array(c),e=0;d>e;)if(f=a[b++],g=(127&f)+1,128&f){for(h=0;c>h;++h)i[h]=a[b++];for(h=0;g>h;++h)j.set(i,e),e+=c}else for(g*=c,h=0;g>h;++h)j[e++]=a[b++];return j}function e(a,b,c,d,e,f,g,h,i,j){var k,l,m,n;for(l=0,n=e;n!==g;n+=f)for(m=h;m!==j;m+=i,l++)k=b[l],a[4*(m+d*n)+3]=255,a[4*(m+d*n)+2]=c[3*k+0],a[4*(m+d*n)+1]=c[3*k+1],a[4*(m+d*n)+0]=c[3*k+2];return a}function f(a,b,c,d,e,f,g,h,i,j){var k,l,m,n;for(l=0,n=e;n!==g;n+=f)for(m=h;m!==j;m+=i,l+=2)k=b[l+0]|b[l+1]<<8,a[4*(m+d*n)+0]=(31744&k)>>7,a[4*(m+d*n)+1]=(992&k)>>2,a[4*(m+d*n)+2]=(31&k)>>3,a[4*(m+d*n)+3]=32768&k?0:255;return a}function g(a,b,c,d,e,f,g,h,i,j){var k,l,m;for(k=0,m=e;m!==g;m+=f)for(l=h;l!==j;l+=i,k+=3)a[4*(l+d*m)+3]=255,a[4*(l+d*m)+2]=b[k+0],a[4*(l+d*m)+1]=b[k+1],a[4*(l+d*m)+0]=b[k+2];return a}function h(a,b,c,d,e,f,g,h,i,j){var k,l,m;for(k=0,m=e;m!==g;m+=f)for(l=h;l!==j;l+=i,k+=4)a[4*(l+d*m)+2]=b[k+0],a[4*(l+d*m)+1]=b[k+1],a[4*(l+d*m)+0]=b[k+2],a[4*(l+d*m)+3]=b[k+3];return a}function i(a,b,c,d,e,f,g,h,i,j){var k,l,m,n;for(l=0,n=e;n!==g;n+=f)for(m=h;m!==j;m+=i,l++)k=b[l],a[4*(m+d*n)+0]=k,a[4*(m+d*n)+1]=k,a[4*(m+d*n)+2]=k,a[4*(m+d*n)+3]=255;return a}function j(a,b,c,d,e,f,g,h,i,j){var k,l,m;for(k=0,m=e;m!==g;m+=f)for(l=h;l!==j;l+=i,k+=2)a[4*(l+d*m)+0]=b[k+0],a[4*(l+d*m)+1]=b[k+0],a[4*(l+d*m)+2]=b[k+0],a[4*(l+d*m)+3]=b[k+1];return a}b.Type={NO_DATA:0,INDEXED:1,RGB:2,GREY:3,RLE_INDEXED:9,RLE_RGB:10,RLE_GREY:11},b.Origin={BOTTOM_LEFT:0,BOTTOM_RIGHT:1,TOP_LEFT:2,TOP_RIGHT:3,SHIFT:4,MASK:48},b.prototype.open=function(a,b){var c,d=this;c=new XMLHttpRequest,c.responseType="arraybuffer",c.open("GET",a,!0),c.onload=function(){200===this.status&&(d.load(new Uint8Array(c.response)),b&&b.call(d))},c.send(null)},b.prototype.load=function(a){var e=0;if(a.length<18)throw new Error("Targa::load() - Not enough data to contain header");if(this.header={idLength:a[e++],colorMapType:a[e++],imageType:a[e++],colorMapIndex:a[e++]|a[e++]<<8,colorMapLength:a[e++]|a[e++]<<8,colorMapDepth:a[e++],offsetX:a[e++]|a[e++]<<8,offsetY:a[e++]|a[e++]<<8,width:a[e++]|a[e++]<<8,height:a[e++]|a[e++]<<8,pixelDepth:a[e++],flags:a[e++]},this.header.hasEncoding=this.header.imageType===b.Type.RLE_INDEXED||this.header.imageType===b.Type.RLE_RGB||this.header.imageType===b.Type.RLE_GREY,this.header.hasColorMap=this.header.imageType===b.Type.RLE_INDEXED||this.header.imageType===b.Type.INDEXED,this.header.isGreyColor=this.header.imageType===b.Type.RLE_GREY||this.header.imageType===b.Type.GREY,c(this.header),e+=this.header.idLength,e>=a.length)throw new Error("Targa::load() - No data");if(this.header.hasColorMap){var f=this.header.colorMapLength*(this.header.colorMapDepth>>3);this.palette=a.subarray(e,e+f),e+=f}var g=this.header.pixelDepth>>3,h=this.header.width*this.header.height,i=h*g;this.imageData=this.header.hasEncoding?d(a,e,g,i):a.subarray(e,e+(this.header.hasColorMap?h:i))},b.prototype.getImageData=function(a){var l,m,n,o,p,q,r,c=this.header.width,d=this.header.height,k=(this.header.flags&b.Origin.MASK)>>b.Origin.SHIFT;switch(a||(a=document?document.createElement("canvas").getContext("2d").createImageData(c,d):{width:c,height:d,data:new Uint8ClampedArray(4*c*d)}),k===b.Origin.TOP_LEFT||k===b.Origin.TOP_RIGHT?(o=0,p=1,q=d):(o=d-1,p=-1,q=-1),k===b.Origin.TOP_LEFT||k===b.Origin.BOTTOM_LEFT?(l=0,m=1,n=c):(l=c-1,m=-1,n=-1),this.header.pixelDepth){case 8:r=this.header.isGreyColor?i:e;break;case 16:r=this.header.isGreyColor?j:f;break;case 24:r=g;break;case 32:r=h}return r(a.data,this.imageData,this.palette,c,o,p,q,l,m,n),a},b.prototype.getCanvas=function(){var a,b,c;return a=document.createElement("canvas"),b=a.getContext("2d"),c=b.createImageData(this.header.width,this.header.height),a.width=this.header.width,a.height=this.header.height,b.putImageData(this.getImageData(c),0,0),a},b.prototype.getDataURL=function(a){return this.getCanvas().toDataURL(a||"image/png")};var k={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return b}):k.exports="undefined"!=typeof window?window:a:k.exports=exports,k.exports&&(k.exports.TGA=b)}(this);